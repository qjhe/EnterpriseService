<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <title>申请证书</title>
	    <link href="css/esStyle.css" rel="stylesheet"/>
	    <script src="js/jquery-1.11.1.min.js"></script>
	    <script src="js/ecJs.js"></script>
	</head>
	<body>
		<div id="esHeader" class="es-comWidth clearFiex">
		    <div class="es-logo-area clearFiex fl">
		        <a class="es-logo-a fl" href="javascript:;"></a>
		
		        <h2 class="fl">恒善普惠 · 企业服务管理系统 </h2>
		    </div>
		    <ul class="es-nav fl">
		        <li class="active">企业管理</li>
		        <li>修改密码</li>
		    </ul>
		    <div class="es-login-info fr"><span>欢迎您，<font>admin</font></span><a href="javascript:;">退出</a></div>
		</div>
		<!--头部结束-->
		
		<!--主体开始-->
		<div class="es-tcon">
			<div class="es-containBox">
				<h1 class="es-cb-tit"><em></em>找回登录密码</h1>
				<div class="es-cb-con es-cb-conPwd">
					<form action="" method="post">
						<div class="es-cb-item">
							<div class="es-cb-input clearFiex">
								<span class="es-cb-name">原登录密码</span>
								<input type="password" name="" id="origPwdT" value="" placeholder="请输入原登录密码" class="es-cbinput" autocomplete="off"/>
								<p class="es-error-msg"><em></em><span></span></p>
							</div>
						</div>
						<div class="es-cb-item">
							<div class="es-cb-input">
								<span class="es-cb-name">新登录密码</span>
								<input type="password" name="" id="newPwd1" value="" placeholder="请输入新登录密码" class="es-cbinput" autocomplete="off"/>
								<p class="es-error-msg"><em></em><span></span></p>
							</div>
						</div>
						<div class="es-cb-item">
							<div class="es-cb-input">
								<span class="es-cb-name">确认新登录密码</span>
								<input type="password" name="" id="newPwd2" value="" placeholder="请再次输入新登录密码" class="es-cbinput" autocomplete="off"/>
								<p class="es-error-msg"><em></em><span></span></p>
							</div>
						</div>
						
						<div class="es-cb-item">
							<div class="es-cb-input">
								<span class="es-cb-name">&nbsp;</span>
								<input type="button" name="" id="es-comBtn" value="提交" class="es-cbinput1"/>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!--主体结束-->
		<div class="es-tfooter">
			<p>北京恒善普惠信息咨询有效公司  |  ©2016 squcorp.com All Rights Reserved  |  京ICP备 xxxxxx 号  |  京公网安备 xxxxxx</p>
		</div>
		<script src="js/jquery-1.11.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jQuery.md5.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/esValidate.js"></script>
		<script type="text/javascript">
			//错误提示信息
		    function errorInfoShow(obj, msg) {
		        obj.show();
		        if (msg != "") {
		            obj.removeClass("es-right").addClass("es-error");
		            obj.find("span").html(msg);
		        } else {
		            obj.removeClass("es-error").addClass("es-right");
		            obj.find("span").html(msg);
		        }
		    }
		    $(".es-cbinput").on("focus", function () {
		        $(this).addClass("active");
		        $(this).parent().siblings(".es-cb-info").addClass("active");
		    })
		    $(".es-cbinput").on("blur", function () {
		        $(this).removeClass("active");
		        $(this).parent().siblings(".es-cb-info").removeClass("active");
		    })
		    var iMv = new mValidate();
		    //失去焦点原始密码验证 s
		    $("#origPwdT").on("blur input",function(){
		    	if (!iMv.isEmpty($("#origPwdT").val())) {//验证空
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请输入原始密码");
		            return false;
		        }
		    	if (!iMv.vPwd($("#origPwdT").val())) {//验证格式 
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码必须为不包含空格非纯数字或纯字母的6~18位字符");
		            return false;
		        }else{
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
		    });
			//失去焦点新密码验证 s
			$("#newPwd1").on("blur input",function(){
				if (!iMv.isEmpty($("#newPwd1").val())) {//验证空
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请输入新密码");
		            return false;
		        }
				if (!iMv.vPwd($("#newPwd1").val())) {//验证格式 
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码必须为不包含空格非纯数字或纯字母的6~18位字符");
		            return false;
		        }else if(iMv.vEqualTo($("#origPwdT").val(),$("#newPwd1").val())){
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码与原始密码重复了");
		            return false;
		        }else{
		        	 var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
				
			})
			//失去焦点新2密码验证 s
			$("#newPwd2").on("blur input",function(){
				if (!iMv.isEmpty($("#newPwd2").val())) {//验证空
		            var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请再次输入新密码");
		            return false;
		        }
				if(!iMv.vEqualTo($("#newPwd1").val(),$("#newPwd2").val())){
		            var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "两次密码输入不一致");
		            return false;
		        }else{
		        	 var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
			})
			//失去焦点验证 e
			
			//表单验证  修改密码
			function validate(){
				if (!iMv.isEmpty($("#origPwdT").val())) {//验证空
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请输入原始密码");
		            return false;
		        }
		    	if (!iMv.vPwd($("#origPwdT").val())) {//验证格式 
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码必须为不包含空格非纯数字或纯字母的6~18位字符");
		            return false;
		        }else{
		            var iObj = $("#origPwdT").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
		        
		        /**/
		       if (!iMv.isEmpty($("#newPwd1").val())) {//验证空
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请输入新密码");
		            return false;
		        }
				if (!iMv.vPwd($("#newPwd1").val())) {//验证格式 
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码必须为不包含空格非纯数字或纯字母的6~18位字符");
		            return false;
		        }else if(iMv.vEqualTo($("#origPwdT").val(),$("#newPwd1").val())){
		            var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "密码与原始密码重复了");
		            return false;
		        }else{
		        	 var iObj = $("#newPwd1").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
		        
		        /**/
		       if (!iMv.isEmpty($("#newPwd2").val())) {//验证空
		            var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "请再次输入新密码");
		            return false;
		        }
				if(!iMv.vEqualTo($("#newPwd1").val(),$("#newPwd2").val())){
		            var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "两次密码输入不一致");
		            return false;
		        }else{
		        	 var iObj = $("#newPwd2").siblings(".es-error-msg");
		            errorInfoShow(iObj, "");
		        }
		        
		        return true;
			}
			
			$("#es-comBtn").on("click",function(){
				if(validate()){
					var oldPwd=$.md5($("#origPwdT").val()),
					newPwd=$.md5($("#newPwd1").val());
					updatePwd(oldPwd,newPwd);//修改密码
				}
			})
			
			//修改密码
			function updatePwd(orPwd,newPwd){
				$.post('',{originalPassword:orPwd,newPassword:newPwd},
				function(result){
					if(result.errorCode==0){
						
					}else{
					}
				},'json');
			}
		</script>
	</body>
</html>
